@model FreePBXAIAssistant.Models.KnowledgeBaseViewModel
@{
    ViewData["Title"] = "Knowledge Base";
}

<style>
    .kb-grid {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 24px;
    }

    .kb-sidebar {
        background: var(--surface);
        border-radius: 16px;
        padding: 24px;
        height: fit-content;
        position: sticky;
        top: 24px;
    }

    .kb-sidebar-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .category-list {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .category-item {
        padding: 10px 12px;
        border-radius: 8px;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
    }

        .category-item:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .category-item.active {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

    .category-count {
        font-size: 12px;
        padding: 2px 8px;
        background: var(--border);
        border-radius: 10px;
    }

    .category-item.active .category-count {
        background: var(--primary);
        color: white;
    }

    .kb-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .kb-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
    }

    .search-box {
        flex: 1;
        max-width: 400px;
        position: relative;
    }

    .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
    }

    .search-input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 14px;
    }

    .kb-items-grid {
        display: grid;
        gap: 16px;
    }

    .kb-item {
        background: var(--surface);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
        cursor: pointer;
    }

        .kb-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

    .kb-item-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 12px;
    }

    .kb-item-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
    }

    .kb-item-category {
        display: inline-block;
        padding: 4px 12px;
        background: var(--primary-light);
        color: var(--primary);
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .kb-item-content {
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .kb-item-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 16px;
        border-top: 1px solid var(--border);
    }

    .kb-item-meta {
        display: flex;
        gap: 16px;
        font-size: 12px;
        color: var(--text-secondary);
    }

    .kb-item-actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        padding: 6px 12px;
        border-radius: 8px;
        border: none;
        background: var(--background);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.2s;
    }

        .action-btn:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .action-btn.danger:hover {
            background: #fee2e2;
            color: #dc2626;
        }

    .tags-container {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 12px;
    }

    .tag {
        padding: 4px 10px;
        background: var(--background);
        border-radius: 6px;
        font-size: 11px;
        color: var(--text-secondary);
    }

    .priority-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        color: var(--warning);
    }

    @@media (max-width: 968px) {
        .kb-grid {
            grid-template-columns: 1fr;
        }

        .kb-sidebar {
            position: static;
        }
    }
</style>

<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 class="page-title">Knowledge Base</h1>
            <p class="page-subtitle">Manage AI assistant knowledge and training data</p>
        </div>
        <button class="btn btn-primary" onclick="window.location.href='@Url.Action("Create", "KnowledgeBase")'">
            <span>+ Add Knowledge</span>
        </button>
    </div>
</div>

<div class="kb-grid">
    <aside class="kb-sidebar">
        <div class="kb-sidebar-title">Categories</div>
        <div class="category-list">
            <a href="@Url.Action("Index", new { category = "", search = Model.SearchQuery })"
               class="category-item @(string.IsNullOrEmpty(Model.SelectedCategory) ? "active" : "")">
                <span>All Items</span>
                <span class="category-count">@Model.Items.Count</span>
            </a>
            @foreach (var category in Model.Categories)
            {
                var count = Model.Items.Count(i => i.Category == category);
                <a href="@Url.Action("Index", new { category = category, search = Model.SearchQuery })"
                   class="category-item @(Model.SelectedCategory == category ? "active" : "")">
                    <span>@category</span>
                    <span class="category-count">@count</span>
                </a>
            }
        </div>
    </aside>

    <div class="kb-content">
        <div class="kb-header">
            <form method="get" asp-action="Index" class="search-box">
                <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" name="search" class="search-input" placeholder="Search knowledge base..." value="@Model.SearchQuery" />
                <input type="hidden" name="category" value="@Model.SelectedCategory" />
            </form>
        </div>

        <div class="kb-items-grid">
            @if (Model.Items.Any())
            {
                @foreach (var item in Model.Items)
                {
                    <div class="kb-item">
                        <div class="kb-item-header">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <h3 class="kb-item-title">@item.Title</h3>
                                    @if (item.Priority > 0)
                                    {
                                        <span class="priority-indicator">
                                            <span>⭐</span>
                                            <span>Priority @item.Priority</span>
                                        </span>
                                    }
                                </div>
                                <span class="kb-item-category">@item.Category</span>
                            </div>
                        </div>

                        <div class="kb-item-content">
                            @item.Content
                        </div>

                        @if (!string.IsNullOrEmpty(item.Tags))
                        {
                            <div class="tags-container">
                                @foreach (var tag in item.Tags.Split(',', StringSplitOptions.RemoveEmptyEntries))
                                {
                                    <span class="tag">@tag.Trim()</span>
                                }
                            </div>
                        }

                        <div class="kb-item-footer">
                            <div class="kb-item-meta">
                                <span>📅 Updated @item.UpdatedAt.ToString("MMM dd, yyyy")</span>
                                <span>@(item.IsActive ? "✅ Active" : "❌ Inactive")</span>
                            </div>
                            <div class="kb-item-actions">
                                <button class="action-btn" onclick="window.location.href='@Url.Action("Edit", "KnowledgeBase", new { id = item.Id })'">
                                    ✏️ Edit
                                </button>
                                <form method="post" asp-action="Delete" asp-route-id="@item.Id" style="display: inline;"
                                      onsubmit="return confirm('Are you sure you want to delete this item?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="action-btn danger">
                                        🗑️ Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="card" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 64px; margin-bottom: 16px;">📚</div>
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No knowledge items found</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">
                        @if (!string.IsNullOrEmpty(Model.SearchQuery))
                        {
                            <span>Try adjusting your search criteria</span>
                        }
                        else
                        {
                            <span>Start building your AI knowledge base</span>
                        }
                    </p>
                    <button class="btn btn-primary" onclick="window.location.href='@Url.Action("Create", "KnowledgeBase")'">
                        + Add Your First Item
                    </button>
                </div>
            }
        </div>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <script>
        alert('@TempData["Success"]');
    </script>
}

@if (TempData["Error"] != null)
{
    <script>
        alert('@TempData["Error"]');
    </script>
}